# Arithmetic Encoder - Verification

## Introduction
- The verification process is comprised by several _.sv_ (SystemVerilog) files.
- Each file has a specific purpose and targets the verification of a specific block of the architecture.
- For blocks related directly to the AV1 codec functionality (i.e., stages 1--4), input datasets must be generated from the [AV1 Reference Codebase](https://aomedia.googlesource.com/aom) using the [entenc.c](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/AV1-reference-info/entenc.c) modified file.
- Blocks that aren't related to the AV1 codec (i.e., ([LZC.v](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/rtl/entropy-encoder/LZC.v)) have their data randomly generated by the _SystemVerilog_ testbench.

## Files

The [verification_area](https://github.com/tuliopereirab/arithmetic-encoder-av1/tree/master/verification_area) comprises several SystemVerilog files that allow different kinds of simulation.

- [testbenches/entropy_encoder_tb.sv](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/testbenches/entropy_encoder_tb.sv) is a full simulation for the top-module (and thus all the sub-modules);
- [testbenches/tb_arith_encoder.sv](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/testbenches/tb_arith_encoder.sv) is a SystemVerilog that only simulates the sub-module 'Arith_Encoder' (this sub-module comprises the pipeline stages 1, 2 and 3);
- [testbenches/components/](https://github.com/tuliopereirab/arithmetic-encoder-av1/tree/master/verification_area/testbenches/components) is a directory that comprises testbenches for the different modules found within the repository ([LZC.v](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/rtl/entropy-encoder/LZC.v), [vedic_16x16.v](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/rtl/other-blocks/vedic-multiplier/vedic_16x16.v), etc);
- [add_name_and_link](link) is a directory that comprises testbenches for each of the architecture's blocks.

## Input Files

- All testbenches rely on input data. Sometimes, the input data is randomly generated by the SystemVerilog code itself. However, offenly an input data is required so the testbench and validate the architecture under real world scenarios.

- For all testbenches used to validate the architecture's modules ([entropy_encoder_tb.sv](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/testbenches/entropy_encoder_tb.sv), [tb_arith_encoder.sv](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/testbenches/tb_arith_encoder.sv) or the individual pipeline stages) the input data can be easily generate using the [AV1 Reference Codebase](https://aomedia.googlesource.com/aom) and the modified [entenc.c](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/AV1-reference-info/entenc.c). This execution will generate a .csv file that can be used to simulate the architecture using the testbenches. As one may notice, it'll indeed be necessary for the user to switch the filepaths inside the .sv files.

- For testbenches used to validate components that aren't directly related to the AV1 codec (i.e., LZC or Vedic multiplier), the .sv testbenches will randomly generate input values so it can cover a greater area of the architecture and more accurately validate it.

### How to generate the input file?
1. Download the modified file of the AV1's entropy encoder, [entenc.c](https://github.com/tuliopereirab/arithmetic-encoder-av1/blob/master/verification_area/AV1-reference-info/entenc.c);
2. Download/clone the [AV1's reference code](https://aomedia.googlesource.com/aom/);
3. Copy and overwrite the file _entenc.c_ modified into the folder _aom/aom_dsp_;
4. Run any encoding process according to the procedure as specified in the AV1's website;
5. After the encoding process is completed, access the folder *arith_analysis* created;
6. The normal data sequence for the testbench is a file called *main_data*.

## Observation

- The herein cited testbenches were simulated until **Altera ModelSim**. Therefore, the use of other softwares might required some changes upon the _.sv_ files, or even on the _rtl_ files.
